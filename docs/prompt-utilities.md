# Prompt Utilities v1

Prompt Utilities объединяет шаблоны промтов, переменные и историю вставок для быстрого повторного использования текстов в разных веб‑клиентах.

## Возможности

- **Библиотека шаблонов**: CRUD, поиск и фильтрация по тегам, экспорт/импорт JSON (`userData/templates.json`).
- **Переменные**: синтаксис `{{name}}` или `{{name|default}}` с предпросмотром итогового текста и автоподстановкой значений.
- **История вставок**: до 100 последних операций Insert / Insert + Send (`userData/prompt-history.json`), доступна в выпадающем списке *Recent*.

## Потоки данных

1. Renderer вызывает `window.templates.*`, далее IPC (`templates:list/save/import/export`, `templates:history:*`) → `src/main/services/templates.ts`.
2. Prompt Router формирует запись истории после успешной вставки (ручной или из шаблона).
3. Все данные хранятся локально в userData, токены и сетевые секреты не задействуются.

## Как использовать

1. Откройте экран **Prompt Templates** (кнопка *Prompts* в сайдбаре).
2. Создайте шаблон, при необходимости добавьте переменные (`{{ticketId}}`, `{{summary|no summary}}`).
3. В Prompt Router нажмите **Templates…**, заполните значения переменных и выберите вкладки.
4. Нажмите **Insert** или **Insert + Send** — текст вставится в BrowserView через активный адаптер.
5. Для повторного использования откройте меню **Recent** и выберите нужную запись.

## Формат шаблонов (экспорт)

```json
[
  {
    "id": "uuid",
    "title": "Bug triage",
    "body": "Ticket {{ticketId}} – {{summary|no summary}}",
    "tags": ["support", "analysis"],
    "createdAt": "2024-10-01T12:00:00.000Z",
    "updatedAt": "2024-10-01T12:30:00.000Z",
    "varsMeta": [
      { "name": "ticketId" },
      { "name": "summary", "defaultValue": "no summary" }
    ]
  }
]
```

## Ограничения и детали

- Шаблоны и история сохраняются атомарно (через временный файл).
- История автоматически обрезается до 100 записей.
- Идентификаторы генерируются через `crypto.randomUUID()` (фолбек — случайная строка).
- Переменные чувствительны к регистру, дубликаты нормализуются по имени.
- Перед массовой вставкой убедитесь, что выбранные Web Adapters прошли health-check.
